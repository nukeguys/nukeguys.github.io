{"data":{"site":{"siteMetadata":{"title":"nukeguys blog","description":"about development, life and something.","siteUrl":"https://nukeguys.github.io/"}},"allMarkdownRemark":{"edges":[{"node":{"excerpt":"회사에서 IE10의 지원을 중단하기 위한 근거로 서비스 사용에 대한 브라우저 통계를 확인해야 했다. 가이드를 통해 nginx의 access 로그와  GoAccess…","html":"<p>회사에서 IE10의 지원을 중단하기 위한 근거로 서비스 사용에 대한 브라우저 통계를 확인해야 했다.<br>\n가이드를 통해 nginx의 access 로그와 <a href=\"https://goaccess.io/\">GoAccess</a>에 대해 알게 되었고 이를 사용하여 간단하게 로그 분석을 해봤다.\n단순하게 사용만 해본 터라 깊이는 없지만 오랜만에 사용해본 쉘 명령어도 되짚어 볼 겸 간단하게 정리해 본다.</p>\n<p>우선 서버에서 원격으로 접근 가능한 위치에 받아올 로그 파일을 미리 복사해 두고 scp를 통해 내려 받아 압축을 해제한다. (회사에서는 일주일 단위로 로그를 압축하여 백업하고 있었고, 실 서비스 서버이므로 로컬 PC로 로그파일을 내려 받아서 진행했다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># scp로 로그파일 내려받기</span>\n<span class=\"token function\">scp</span> 계정@호스트:파일경로 저장할파일이름   <span class=\"token comment\"># 원하는 파일만</span>\n<span class=\"token function\">scp</span> -r 계정@호스트:폴더경로 ./ <span class=\"token comment\"># 폴더 통째로</span>\n\n<span class=\"token comment\"># gzip/gunzip으로 압축 해제하기</span>\n<span class=\"token function\">gzip</span> -d access.log-xxxxxxxx.gz <span class=\"token comment\"># (gunzip access.log-xxxxxxxx.gz) 원하는 파일만</span>\ngunzip -r ./accesslog <span class=\"token comment\"># 폴더의 압축파일들을 한 번에 해제</span></code></pre></div>\n<p>로그파일이 준비됐으니 GoAccess를 설치한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> goaccess</code></pre></div>\n<p>GoAccess로 분석을 하기위해 로그파일의 포맷을 설정파일에 명시해야 한다. <code class=\"language-text\">time-format</code>, <code class=\"language-text\">date-format</code>, <code class=\"language-text\">log-format</code> 세 가지만 설정 해주고, 로그가 표준화된 형식일 경우 실행시에 옵션으로 넣어줘도 되는 듯 하다.<br>\n표준화된 형식이 주석으로 있으니 해제하여 사용하거나 없으면 맞게 작성해주면 된다. 내 PC의 설정파일의 위치는 <code class=\"language-text\">/usr/local/Cellar/goaccess/1.2_1/etc/goaccess.conf</code>였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">######################################</span>\n<span class=\"token comment\"># Time Format Options (required)</span>\n<span class=\"token comment\">######################################</span>\ntime-format %H:%M:%S\n\n<span class=\"token comment\">######################################</span>\n<span class=\"token comment\"># Date Format Options (required)</span>\n<span class=\"token comment\">######################################</span>\ndate-format %d/%b/%Y\n\n<span class=\"token comment\">######################################</span>\n<span class=\"token comment\"># Log Format Options (required)</span>\n<span class=\"token comment\">######################################</span>\nlog-format %h - %^ <span class=\"token punctuation\">[</span>%d:%t %^<span class=\"token punctuation\">]</span>  <span class=\"token string\">\"%r\"</span> %s %b <span class=\"token string\">\"%R\"</span> <span class=\"token string\">\"%u\"</span> %T <span class=\"token string\">\"%^\"</span></code></pre></div>\n<p>GoAccess를 사용하기 전에 필요한 로그를 가공 할 필요가 있었다.\n카카오페이지 웹의 경우 PC와 모바일 버전이 다르고(당연히), 모바일의 경우 앱 내에서 호출하는 경우가 있어 제외시켜야 했다. 추가로 리다이렉션(응답코드 30X) 되는 경우도 중복이기 때문에 제외 시켰다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 앱에서 호출하는 경우 userAgent에 KakaoPage가 포함된다.</span>\n<span class=\"token function\">sed</span> <span class=\"token string\">'/KaKaoPage/d'</span> access.log-xxxxxxxx <span class=\"token operator\">></span> 1_only_web\n<span class=\"token comment\"># 응답코드 30X인 레코드를 제외시킨다.(더 정확하게 할 수 있겠지만 이 정도만 해도 충분했다.)</span>\n<span class=\"token function\">sed</span> <span class=\"token string\">'/\" 30. /d'</span> 1_only_web <span class=\"token operator\">></span> 2_delete_redirect</code></pre></div>\n<p>GoAccess를 실행시켜 로그 파일을 분석하고 결과를 html파일로 만든다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">goaccess 2_delete_redirect -a -o 2_delete_redirect.html</code></pre></div>\n<blockquote>\n<p>“끝까지 도달하는 것이 결말을 의미하지는 않는다. 여러 번, 나는 뭔가를 끝내는 것이, 단순히 새로운 길의 시작에 불과한 것인지, 스스로 궁금하다고 생각한다. 그리고 그 질문은, 나를 처음부터 다시 시작하도록 격려해준다.” - 파블로 알보란 -</p>\n</blockquote>\n<h6>참고한 블로그들</h6>\n<ul>\n<li><a href=\"https://ahnheejong.name/\">https://ahnheejong.name/</a></li>\n<li><a href=\"https://blog.cometkim.kr/\">https://blog.cometkim.kr/</a></li>\n<li><a href=\"https://adhrinae.github.io/\">https://adhrinae.github.io/</a></li>\n<li><a href=\"https://blueshw.github.io/\">https://blueshw.github.io/</a></li>\n<li><a href=\"https://blog.hax0r.info/\">https://blog.hax0r.info/</a></li>\n</ul>\n<h6>Thanks to</h6>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/\">gatsby</a></li>\n<li><a href=\"https://bulma.io/\">bulma</a></li>\n<li><a href=\"https://github.com/\">github</a></li>\n<li><a href=\"https://fonts.google.com\">google font</a></li>\n</ul>","fields":{"slug":"/dev/goaccess-analyzer/"},"frontmatter":{"date":"2019/01/24","title":"[TIL] GoAccess로 nginx access 로그 분석 겉핥기","description":"IE10 지원 중단을 위해 GoAccess로 브라우저 통계를 확인 해봤다.","tags":["TIL","GoAccess","nginx","IE10"]}}},{"node":{"excerpt":"…","html":"<p>드디어 오랫동안 만지작거리던 블로그를 완성했다.<br>\n좀 더 마음에 들게 만들고 첫 글도 각 잡고 앉아서 쓰고 올리고 싶었으나,\n지금까지 시도만 여러번으로 일단 시작하자는 생각에 글을 보여줄 수 있는 정도까지만 만들고 나서 올리려다보니 글이 없으면 에러가 나는 바람에 결국 급하게 글을 작성하고 있다.</p>\n<p>평소에 글을 써보고 싶었으나 맘처럼 안되고 주로 정리하는 내용들이다 보니 기술 블로그 비슷한 것도 하나 해보고 싶어서 네이버부터 티스토리, 미디엄, 브런치, <a href=\"https://jekyllrb.com/\">jekyll</a> 그리고 <a href=\"https://www.gatsbyjs.org/\">gatsby</a>까지 시도만 수십 번을 했었다.<br>\n결국 제대로 돌아가고 있는건 없고 그나마 유입이 되는건 <a href=\"http://nukeguys.tistory.com/\">티스토리(http://nukeguys.tistory.com/)</a> 정도인 것 같다. 그래봤자 하루에 1~20명 정도지만…</p>\n<p>아직 갈 길은 멀지만 그래도 이렇게 글을 써서 올린다는 것 만으로도 나름 뿌듯한 감이 있다.\n이전에는 혼자 시도를 하다보니 지속이 안됐던 것 같은데, 지금은 주변에 블로그를 하시는 분들이 있다보니 같이 힘을 받는 것 같다. 아직은 허접하지만 천천히 하나씩 만들고 채우고 가다보면 그럴 듯 해 지는 날이 오겠지.</p>\n<p>이 글이 블로그의 시작이 되고, 블로그가 올해 목표의 출발점이 되어 앞으로 더 많은 시작을 할 수 있기를 바란다.</p>\n<blockquote>\n<p>“끝까지 도달하는 것이 결말을 의미하지는 않는다. 여러 번, 나는 뭔가를 끝내는 것이, 단순히 새로운 길의 시작에 불과한 것인지, 스스로 궁금하다고 생각한다. 그리고 그 질문은, 나를 처음부터 다시 시작하도록 격려해준다.” - 파블로 알보란 -</p>\n</blockquote>\n<h6>참고한 블로그들</h6>\n<ul>\n<li><a href=\"https://ahnheejong.name/\">https://ahnheejong.name/</a></li>\n<li><a href=\"https://blog.cometkim.kr/\">https://blog.cometkim.kr/</a></li>\n<li><a href=\"https://adhrinae.github.io/\">https://adhrinae.github.io/</a></li>\n<li><a href=\"https://blueshw.github.io/\">https://blueshw.github.io/</a></li>\n<li><a href=\"https://blog.hax0r.info/\">https://blog.hax0r.info/</a></li>\n</ul>\n<h6>Thanks to</h6>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/\">gatsby</a></li>\n<li><a href=\"https://bulma.io/\">bulma</a></li>\n<li><a href=\"https://github.com/\">github</a></li>\n<li><a href=\"https://fonts.google.com\">google font</a></li>\n</ul>","fields":{"slug":"/life/hello-world/"},"frontmatter":{"date":"2019/01/09","title":"시작","description":"gatsby로 블로그를 만들고 처음 쓰는 글","tags":["블로그","gatsby","시작","가즈아"]}}}]}},"pageContext":{}}